
{
  "entities": {
    "user": {
      "title": "User",
      "description": "A user of the application.",
      "type": "object",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID." },
        "displayName": { "type": "string", "description": "The user's display name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "photoURL": { "type": "string", "format": "uri", "description": "The URL of the user's profile picture." },
        "roles": {
            "type": "array",
            "items": { "type": "string" },
            "description": "User roles (e.g., 'admin', 'professional')."
        },
        "therapistId": { "type": "string", "description": "The ID of the associated therapist profile, if any." }
      },
      "required": ["uid"]
    },
    "chat": {
      "title": "Chat",
      "description": "A chat session, containing metadata about the conversation.",
      "type": "object",
      "properties": {
        "title": { "type": "string", "description": "The title of the chat." },
        "createdAt": { "type": "string", "format": "date-time" },
        "userId": { "type": "string" },
        "path": { "type": "string" },
        "latestMessageAt": { "type": "string", "format": "date-time" },
        "anchorRole": { "type": "string" }
      },
      "required": ["title", "createdAt", "userId", "path"]
    },
    "message": {
      "title": "Message",
      "description": "A single message within a chat.",
      "type": "object",
      "properties": {
        "role": { "type": "string", "enum": ["user", "assistant"] },
        "content": { "type": "string" },
        "timestamp": { "$ref": "https://firebase.google.com/docs/reference/js/firebase.firestore.Timestamp" },
        "imageUrl": { "type": "string", "format": "uri" }
      },
      "required": ["role", "content", "timestamp"]
    },
    "therapist": {
      "title": "Therapist",
      "description": "A public profile of a verified therapist on the platform.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "The ID of the user account associated with this profile." },
        "name": { "type": "string" },
        "photoUrl": { "type": "string", "format": "uri" },
        "rating": { "type": "number" },
        "reviewsCount": { "type": "number" },
        "specialties": { "type": "array", "items": { "type": "string" } },
        "pricePerSession": { "type": "number" },
        "languages": { "type": "array", "items": { "type": "string" } },
        "verified": { "type": "boolean" },
        "published": { "type": "boolean", "description": "If the profile is visible in the marketplace." },
        "credentials": { "type": "string" },
        "bio": { "type": "string" }
      },
      "required": ["id", "userId", "name", "photoUrl", "specialties", "pricePerSession", "languages", "credentials", "bio"]
    },
    "therapistApplication": {
        "title": "Therapist Application",
        "description": "An application submitted by a user to become a therapist.",
        "type": "object",
        "properties": {
            "userId": { "type": "string" },
            "displayName": { "type": "string" },
            "email": { "type": "string" },
            "status": { "type": "string", "enum": ["pending", "approved", "rejected"] },
            "submittedAt": { "type": "string", "format": "date-time" },
            "applicationData": { "$ref": "#/entities/therapistApplicationData" }
        },
        "required": ["userId", "status", "submittedAt", "applicationData"]
    },
    "therapistApplicationData": {
        "title": "Therapist Application Data",
        "description": "Detailed information and files submitted in a therapist application.",
        "type": "object",
        "properties": {
            "name": { "type": "string" },
            "credentials": { "type": "string" },
            "bio": { "type": "string" },
            "specialties": { "type": "array", "items": { "type": "string" } },
            "languages": { "type": "array", "items": { "type": "string" } },
            "pricePerSession": { "type": "number" },
            "identityDocumentUrl": { "type": "string", "format": "uri" },
            "professionalLicenseUrl": { "type": "string", "format": "uri" }
        }
    },
    "userProfile": {
      "title": "User Profile",
      "description": "A comprehensive AI-generated psychological profile of the user.",
      "type": "object",
      "properties": {
        "diagnosis": { "type": "string" },
        "personality": { "type": "string" },
        "recommendations": { "type": "array", "items": { "type": "string" } },
        "strengths": { "type": "string" },
        "cognitiveBiases": { "type": "array", "items": { "type": "string" } },
        "defenseMechanisms": { "type": "array", "items": { "type": "string" } },
        "emotionalJourney": {
          "type": "array",
          "items": { "type": "object", "properties": { "date": { "type": "string" }, "sentiment": { "type": "number" }, "summary": { "type": "string" }, "keyEvents": { "type": "array", "items": { "type": "string" } } } }
        },
        "emotionalConstellation": { "$ref": "#/entities/emotionalConstellation" },
        "coreArchetype": { "type": "object", "properties": { "title": { "type": "string" }, "description": { "type": "string" }, "strengths": { "type": "string" }, "challenges": { "type": "string" } } },
        "coreConflict": { "type": "string" },
        "habitLoop": { "$ref": "#/entities/habitLoop" }
      }
    },
     "emotionalConstellation": {
      "title": "Emotional Constellation",
      "description": "A graph-based representation of a user's emotional and thematic landscape.",
      "type": "object",
      "properties": { "nodes": { "type": "array", "items": { "type": "object", "properties": { "id": { "type": "string" }, "val": { "type": "number" } }, "required": ["id", "val"] } }, "links": { "type": "array", "items": { "type": "object", "properties": { "source": { "type": "string" }, "target": { "type": "string" }, "sentiment": { "type": "number" } }, "required": ["source", "target", "sentiment"] } } }, "required": ["nodes", "links"]
    },
    "habitLoop": { "title": "Habit Loop", "description": "Analysis of a recurring behavioral loop.", "type": "object", "properties": { "trigger": { "type": "string" }, "thought": { "type": "string" }, "action": { "type": "string" }, "result": { "type": "string" } } },
    "simulationScenario": { "title": "Simulation Scenario", "description": "A predefined scenario for the Emotional Gym.", "type": "object", "properties": { "id": { "type": "string" }, "title": { "type": "string" }, "description": { "type": "string" }, "category": { "type": "string" }, "personaPrompt": { "type": "string" } }, "required": ["id", "title", "description", "category", "personaPrompt"] },
    "simulationSession": { "title": "Simulation Session", "description": "A record of a user's practice session in the Emotional Gym.", "type": "object", "properties": { "userId": { "type": "string" }, "scenarioId": { "type": "string" }, "scenarioTitle": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" }, "completedAt": { "type": "string", "format": "date-time" }, "feedback": { "type": "string" }, "path": { "type": "string" } }, "required": ["userId", "scenarioId", "scenarioTitle", "createdAt", "path"] },
    "dreamInterpretation": { "title": "Dream Interpretation", "description": "An AI-generated interpretation of a user's dream.", "type": "object", "properties": { "userId": { "type": "string" }, "dreamDescription": { "type": "string" }, "interpretation": { "type": "object", "properties": { "dreamTitle": { "type": "string" }, "dominantFeeling": { "type": "string" }, "coreArchetype": { "type": "string" }, "symbolAnalysis": { "type": "array", "items": { "$ref": "#/entities/symbolAnalysis" } }, "narrativeInterpretation": { "type": "string" }, "reflectiveQuestion": { "type": "string" } } }, "createdAt": { "type": "string", "format": "date-time" } }, "required": ["userId", "dreamDescription", "interpretation", "createdAt"] },
    "symbolAnalysis": { "title": "Symbol Analysis", "description": "Analysis of a single symbol within a dream.", "type": "object", "properties": { "symbol": { "type": "string" }, "universalMeaning": { "type": "string" }, "personalMeaning": { "type": "string" }, "icon": { "type": "string" } } },
    "aetherWorldState": { "title": "Aether World State", "properties": { "tick": { "type": "number" }, "agents": { "type": "array", "items": { "$ref": "#/entities/aetherAgent" } }, "eventLog": { "type": "array", "items": { "$ref": "#/entities/aetherEvent" } }, "supervisorAnalysis": { "type": "string" } } },
    "aetherAgent": { "title": "Aether Agent", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "archetype": { "type": "string" }, "primaryGoal": { "type": "string" }, "greatestFear": { "type": "string" }, "position": { "type": "object", "properties": { "x": { "type": "number" }, "y": { "type": "number" }, "z": { "type": "number" } } }, "status": { "type": "string" }, "thought": { "type": "string" }, "lastAction": { "type": "string" } } },
    "aetherEvent": { "title": "Aether Event", "properties": { "tick": { "type": "number" }, "description": { "type": "string" } } }
  },
  "auth": {
    "providers": ["google.com"]
  },
  "firestore": {
    "/users/{userId}": { "schema": { "$ref": "#/entities/user" }, "rules": "auth.uid == userId" },
    "/users/{userId}/chats/{chatId}": { "schema": { "$ref": "#/entities/chat" }, "rules": "auth.uid == userId" },
    "/users/{userId}/chats/{chatId}/messages/{messageId}": { "schema": { "$ref": "#/entities/message" }, "rules": "auth.uid == userId" },
    "/users/{userId}/chatbotState/main": { "schema": { "$ref": "#/entities/chatbotState" }, "rules": "auth.uid == userId" },
    "/users/{userId}/profile/main": { "schema": { "$ref": "#/entities/userProfile" }, "rules": "auth.uid == userId" },
    "/users/{userId}/gymSessions/{sessionId}": { "schema": { "$ref": "#/entities/simulationSession" }, "rules": "auth.uid == userId" },
    "/users/{userId}/gymSessions/{sessionId}/messages/{messageId}": { "schema": { "$ref": "#/entities/message" }, "rules": "auth.uid == userId" },
    "/users/{userId}/dreams/{dreamId}": { "schema": { "$ref": "#/entities/dreamInterpretation" }, "rules": "auth.uid == userId" },
    
    "/therapists/{therapistId}": {
        "schema": { "$ref": "#/entities/therapist" },
        "rules": {
            "read": "true",
            "write": "request.auth.token.roles.hasAny(['admin'])"
        }
    },
    "/therapistApplications/{applicationId}": {
        "schema": { "$ref": "#/entities/therapistApplication" },
        "rules": {
            "get": "resource.data.userId == request.auth.uid || request.auth.token.roles.hasAny(['admin'])",
            "list": "request.auth.token.roles.hasAny(['admin'])",
            "create": "request.resource.data.userId == request.auth.uid",
            "update": "request.auth.token.roles.hasAny(['admin'])"
        }
    }
  }
}

